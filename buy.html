<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy page</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/media.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
</head>
<body>
    <header class="header">
        <!-- <section class="gradient-block">
            <div class="gradient-block__center"></div>
        </section> -->
        <div class="container">
            <section class="header-section">
                <a href="index.html">
                    <img src="./img/logo.svg" alt="logo.svg" class="logo">
                </a>
                <h2 class="footer-logo-nav__logo logo-nav">
                    <a href="index.html">IT-РЕШЕНИЯ 360</a>
                </h2>
                <div class="burger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <nav class="nav-menu">
                    <ul class="nav-menu-list">
                        <li class="nav-menu-list__item"><a href="index.html">ГЛАВНАЯ</a></li>
                        <li class="nav-menu-list__item"><a href="services.html">УСЛУГИ</a></li>
                        <li class="nav-menu-list__item"><a href="catalog.html">КАТАЛОГ</a></li>
                        <li class="nav-menu-list__item"><a href="about-us.html">О нас</a></li>
                        <li class="nav-menu-list__item"><a href="contacts.html">Контакты</a></li>
                    </ul>
                </nav>
            </section>
        </div>
    </header>

    <main class="main">
        <section data-aos="flip-left" class="buy-area">
            <div class="container">
                <!-- <section class="gradient-block">
                    <div class="gradient-block__center"></div>
                </section> -->
                <div class="buy-area__img-cont">
                    <img src="" alt="" class="buy-img">
                </div>
                <div class="buy-area__info-cont">
                    <h1 class="buy__parag"></h1>
                    <p class="buy__description"></p>
                    <button onclick="initPayment(this)" class="main-product" data-amount="50000">Купить</button>
                </div>
            </div>
        </section>
        <section class="gradient-block">
            <div class="gradient-block__center"></div>
    </section>
    </main>

    <footer class="footer">
        <div class="footer-shadow"></div>
        <div class="container">
            <div class="footer-logo-nav">
                <h2 class="footer-logo-nav__logo">
                    <a href="index.html">IT-РЕШЕНИЯ 360</a>
                </h2>
                <nav class="footer-logo-nav__nav">
                    <ul class="footer-logo-nav__nav-list">
                        <li class="footer-logo-nav__nav-list-li">
                            <a href="services.html" class="footer-logo-nav__nav-list-link">УСЛУГИ</a>
                        </li>
                        <li class="footer-logo-nav__nav-list-li">
                            <a href="catalog.html" class="footer-logo-nav__nav-list-link">КАТАЛОГ</a>
                        </li>
                        <li class="footer-logo-nav__nav-list-li">
                            <a href="about-us.html" class="footer-logo-nav__nav-list-link">О нас</a>
                        </li>
                        <li class="footer-logo-nav__nav-list-li">
                            <a href="contacts.html" class="footer-logo-nav__nav-list-link">Контакты</a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="footer-description">
                <p class="footer-description__text">
                    Сервис, созданный для людей, которым нужно профессиональное сопровождение в освоении, оптимизации и использовании современных технологий
                </p>
            </div>
        </div>
    </footer>
    <script>
        console.log("URL:", window.location.href);
        const urlParams = new URLSearchParams(window.location.search);
        const idProd = urlParams.get("id"); // Получаем id из URL
        console.log("Извлечённый idProd:", idProd);


        async function initPayment(button) {
        const urlParams = new URLSearchParams(window.location.search);
        const idProd = urlParams.get("id"); // Получаем id из URL
        const amount = button.getAttribute("data-amount");

        // Проверка на валидность id и amount
        if (!idProd || !amount) {
            alert("Ошибка: некорректные параметры");
            return;
        }

        console.log("idProd из URL:", idProd);  // Логируем значение id
        console.log("Отправляемая сумма:", amount);

        const successUrl = `https://info-products-360.netlify.app/success?id=${idProd}`;
        const failUrl = `https://info-products-360.netlify.app/fail?id=${idProd}`;

        console.log("idProd перед отправкой:", idProd);


        const response = await fetch("/.netlify/functions/initPayment", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ amount, id: idProd, successUrl, failUrl })
        });

        const result = await response.json();
        console.log("Ответ сервера:", result);

        if (result.paymentUrl) {
            window.location.href = result.paymentUrl;
        } else {
            alert("Ошибка: " + result.error);
        }
    }
    </script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="./js/main.js"></script>
    <script src="./js/burger.js"></script>
    <script type="module" src="./js/products.js"></script>
</body>
</html>